# Looping

같은 네트워크 대역 대에서 스위치에 연결된 경로가 2개 이상인 경우에 발생

PC가 브로드캐스팅 패킷을 스위치들에게 전달하고 전달 받은 스위치들은 Flooding을 한다.

스위치들끼리 Flooding된 프레임이 서로 계속 전달되어 네트워크에 문제를 일으킨다.

회선 및 스위치 이중화 또는 증축 등에 의해 발생

물리적인 포트 연결의 실수 또는 잘못된 이중화 구성으로 L2에서 가장 빈번히 발생하는 이슈
![image](https://user-images.githubusercontent.com/13481627/92523139-d30c5280-f25a-11ea-9bc7-3ad6a38a5cac.png)

## STP : 스패닝 트리 프로토콜

자동으로 루핑을 막아주는 알고리즘 -> 스패닝 트리 알고리즘

1. Bridge ID : 스위치의 우선순의로 0~65535로 설정, 낮을 수록 우선순위가 높다.
2. Path Cost : 링크의 속도(대역폭), 1000/링크 속도로 계산되며 작을수록 우선순위가 높다. 그러나 현재 1Gbps의 대역폭이 나오면서 링크 속도 나누는 것에 대한 적합한 계산법이 안됨으로써 IEEE에서 각 대역폭 별 숫자를 정의함.

- BPDU : 스패닝 트리 프로토콜에 의해 스위치간 서로 주고받는 제어 프레임

1. Configuration BPDU : 구성 관련

- Root BID : 루트 브리지로 선출될 스위치 정보
- Path Cost : 루트 브리지까지의 경로 비용
- Bridge ID, Port ID : 나머지 스위치와 포트의 우선순위

2. TCN : BPDU

- 네트워크 내 구성 변경 시 통보

### 상태변화

- Disabled : 포트가 셧다운인 상태로 데이터 전송 불가. MAC 학습 불가, BPDU 송수신 불가
- Blocking : 부팅하거나 Disabled 상태를 up 했을 때 첫 번째 거치는 단계, BPDU만 송수신
- Listening : Blocking 포트가 루트 또는 데지그네이티드 포트로 선정되는 단계, BPDU만 송수신
- Learning : 리스닝 상태에서 특정 시간이 흐른 후 러닝 상태가 됨, MAC 학습 시작, BPDU만 송수신
- Forwarding : 러닝 상태에서 특정 시간이 흐른 후 포워딩 상태가 됨, 데이터 전송 시작, BPDU 송수신

## RSTP

스패닝 트리가 동작하는 과정은 30~50초가 걸린다. 그래서 매우 네트워크 동신 성능 저하가 일어난다. 이를 빠르게 해결하기 위해서 RSTP를 이용한다.

RSTP는 스패닝 트리 내 스위치 상태 변화 5가지 중, Listening과 Learning을 없앤 방식이다. 1~2초까지 단축 시킨다.

- 원리 : Block되었던 스위치가 다른 스위치들보다 자신의 BPDU 정보가 우선순위가 높다고 판단되면, 자신이 designate 포트가 되겠다는 proposal PDU를 전송한다. 이 포트를 수신한 상대 포트가 자신이 루트 포트가 되겠다는 agreement 신호를 보내서 해당 포트를 바로 forwarding 상태로 변경한다.

## MST

스위치 BPDU 개수가 많아져 복잡해져 관리가 힘든 상황을 대비하여, 각 STP 그룹들을 묶어서 효율적으로 관리.
